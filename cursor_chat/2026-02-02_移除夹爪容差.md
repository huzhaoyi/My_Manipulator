# 移除夹爪容差，完全采用稳定性判断

## 背景

用户问「为什么现在还要容差」：当前夹爪到位判断已改为**基于实机反馈稳定性**（连续采样变化小于阈值即视为到位），不再需要「与目标值在容差内」的判定，因此应彻底移除夹爪相关容差参数与逻辑。

## 修改内容

### 1. 接口与实现（无容差参数）

- **`hw/gripper_interface.hpp`**  
  - `isOpenToTarget(double tolerance_rad)` → `isOpenToTarget()`  
  - `isClosedToTarget(double tolerance_rad)` → `isClosedToTarget()`  
  - 注释改为：仅依据稳定性验证标志，无容差参数。

- **`execution/gripper_controller.hpp`**  
  - `setParameters` 去掉 `verify_tolerance_rad` 参数。  
  - 去掉成员 `verify_tolerance_rad_` 和 `isAtTargetWithMirror`。  
  - 增加 `last_open_verified_stable_`，与 `last_close_verified_stable_` 对称。  
  - `isOpenToTarget()` / `isClosedToTarget()` 仅依据上述标志，无容差。

- **`execution/gripper_controller.cpp`**  
  - `setParameters` 不再接收、保存容差。  
  - 删除 `isAtTargetWithMirror`。  
  - `isOpenToTarget()`：仅当 `last_open_verified_stable_` 为 true 时返回 true 一次并清除。  
  - `isClosedToTarget()`：仅当 `last_close_verified_stable_` 为 true 时返回 true 一次并清除（去掉原先基于容差的 fallback）。  
  - **打开也做稳定性验证**：`openToWidth()` 在执行成功后，与 `closeToWidth()` 一致，先短延时再调用 `isFeedbackStable()`，通过则设置 `last_open_verified_stable_ = true`，否则返回 false。

### 2. FSM / 参数 / 配置

- **`fsm/grasp_fsm.hpp`**  
  - `Config` 中删除 `gripper_tolerance_rad`。

- **`fsm/grasp_fsm.cpp`**  
  - `handleWaitGripper` 中调用 `gripper_->isOpenToTarget()`、`gripper_->isClosedToTarget()` 不再传容差。

- **`utils/parameter_manager.hpp`**  
  - 删除 `gripper_verify_tolerance_rad`。

- **`utils/parameter_manager.cpp`**  
  - 声明与加载中删除 `gripper.verify_tolerance_rad`。

- **`config/cable_grasp.yaml`**  
  - 删除 `gripper.verify_tolerance_rad` 项。

- **`m5_grasp.cpp`**  
  - `gripper_controller_->setParameters(...)` 不再传 `gripper_verify_tolerance_rad`。  
  - `fsm_config` 不再设置 `gripper_tolerance_rad`。

## 结论

- 夹爪「到位」判断**只依赖稳定性**：`openToWidth`/`closeToWidth` 执行成功后做反馈稳定性检查，通过则置对应 `last_*_verified_stable_`，FSM 通过 `isOpenToTarget()`/`isClosedToTarget()` 消费该标志。  
- 已无任何夹爪容差参数或容差比较逻辑；若稳定性验证未通过，则 open/close 返回 false，FSM 依赖超时进入失败分支。
