/**:
  ros__parameters:
    cable:
      name: "cable_1"
      diameter: 0.050          # m  缆绳直径（47mm）
      length: 0.020             # m  用于碰撞近似的长度（可以只取局部一段）
      center_offset_z: 0.0     # m  cable_pose到圆柱中心的Z偏移（默认0.0表示cable_pose是中心，如需从底部推中心可设为length*0.5）

    grasp:
      approach_offset_z: 0.10  # m  预抓取点：目标上方10cm
      descend_distance: 0.08   # m  下压距离（用于cartesian path）
      lift_distance: 0.06      # m  抬起确认高度（IK 抬升时用于目标位姿 Z 偏移）
      # 抬升方式：4-DOF 仅用关节/IK，不用笛卡尔。IK 无解时用关节空间偏移（J2/J3 开臂抬升）
      lift_joint_delta_J2: 0.10   # rad  IK 无解时 Joint2 偏移量（正=抬升方向，约 5.7°）
      lift_joint_delta_J3: 0.10   # rad  IK 无解时 Joint3 偏移量（正=抬升方向）
      use_cartesian: true
      eef_step: 0.015          # m  笛卡尔步长（厂家建议：点要散一点，不要过密，减少抖动；原 0.005 过密）
      jump_threshold: 1.0      # 跳跃阈值（0表示关闭检查，建议使用1.0或2.0以确保安全）
      
      # MoveIt规划参数（优先稳定性和平滑度，不追求速度）
      planning_time: 30.0      # s  默认规划时间（增加到30秒，确保找到高质量解）
      num_planning_attempts: 50 # 规划尝试次数（增加到50次，提高成功率）
      max_velocity_scaling: 0.3  # 最大速度缩放因子（降到30%，更平滑）
      max_acceleration_scaling: 0.2  # 最大加速度缩放因子（降到20%，减少抖动）
      goal_position_tolerance: 0.01  # m  目标位置容差
      goal_orientation_tolerance: 0.5  # rad  目标姿态容差
      fallback_planning_time: 5.0  # s  fallback策略的规划时间（增加到5秒）
      
      # yaw调整参数（用于xyz+yaw抓取模式）；yaw 等同于 joint4（发 90 即 90）
      yaw_offset: 0.0  # rad  yaw偏移量，用于微调夹爪方向
      yaw_flip: false  # bool  是否翻转yaw 180度（遇到方向反了时使用）
      grasp_yaw_add: 0.0  # rad  默认0：yaw=joint4。若需“夹爪垂直于缆绳”等固定偏移可设为 1.5708（90°）
      z_clearance: 0.002  # m  抓取高度安全余量（默认2mm），避免下压过猛
      
      # yaw合法性检查参数
      yaw_validation_enabled: true  # 是否启用yaw合法性检查（检查yaw在特定z高度下是否IK可解）
      yaw_tolerance: 0.0873  # rad  yaw搜索容差（默认±5°，约0.0873 rad）
      yaw_search_step: 0.0175  # rad  yaw搜索步长（默认1°，约0.0175 rad）
      
      # Joint4-yaw映射优化参数
      joint4_yaw_search_enabled: false  # 禁用Joint4-yaw搜索（Joint4 ≠ 末端yaw，不应进行对比）
      joint4_yaw_search_range: 3.1416  # rad  Joint4-yaw搜索范围（默认±180度，约3.1416 rad）
      joint4_yaw_search_step: 0.0873  # rad  Joint4-yaw搜索步长（默认5度，约0.0873 rad）
      
      # yaw候选搜索参数（用于仅xyz输入）
      yaw_candidate_search_enabled: true  # 是否启用yaw候选搜索
      yaw_candidate_center: 0.0  # rad  候选搜索中心yaw（仅xyz输入时使用）
      yaw_candidate_range: 3.1416  # rad  搜索范围（±180°）
      yaw_candidate_step: 0.2618  # rad  搜索步长（15°，约0.2618 rad）
      
      # 地面安全参数（支架测试时可不加地面，视觉可发负 z）
      ground_height: 0.0  # m  地面高度（如果为0，则根据基座位置自动计算）
      ground_offset_below_base: -0.35  # m  地面在基座下方的偏移（-5cm，基座下方5cm）
      camera_error_margin: 0.005  # m  相机标定误差余量（5mm）
      min_ground_clearance: 0.010  # m  最小离地安全距离（10mm）
      add_ground_plane: false  # 是否添加地面碰撞对象（false=去除地面障碍，支架测试、视觉 position.z 可为负）
      
      # 下压距离限制
      max_cartesian_descend_distance: 0.15  # m  单次笛卡尔下压最大距离（15cm）
      
      # 状态回滚参数
      enable_recovery: true  # 是否启用执行失败后的状态回滚
      recovery_timeout: 5.0  # s  回滚操作的超时时间
      
      # TCP偏移补偿参数（LinkGG到夹爪中心的偏移，在EEF frame中）
      tcp_offset_x: 0.0  # m  TCP偏移X（LinkGG→夹爪中心）
      tcp_offset_y: -0.024  # m  TCP偏移Y（LinkGG→夹爪中心）
      tcp_offset_z: -0.0086  # m  TCP偏移Z（LinkGG→夹爪中心）
      
      # IK和状态检查参数
      ik_timeout: 0.1          # s  IK求解超时时间
      state_check_timeout: 1.0  # s  状态检查超时时间
      state_check_interval: 0.1  # s  状态检查间隔
      
      # 启动等待时间
      robot_state_publisher_wait: 2.0  # s  等待robot_state_publisher启动的时间
      executor_startup_wait: 0.5       # s  executor启动后的等待时间
      segment_execution_wait: 0.5      # s  分段执行后的等待时间（确保状态稳定，从0.1s增加到0.5s，避免状态未稳定）
      state_sync_wait: 0.1             # s  执行前状态同步等待时间（等待current_state更新，经验值0.1s）
      
      # 机械臂控制频率
      main_loop_frequency: 20.0        # Hz  main循环频率

    fsm:
      # 夹爪开/闭后等待时间（ms），应 ≥ 夹爪范围执行时间 7.5s，避免未完成就进入下一状态
      gripper_wait_ms: 8000   # 8s（夹爪全行程 7.5s，见 trajectory.range_execution_time.gripper）
      # 闭合后最小停留 (ms)，再允许转 LIFT；2~4s 更保守，避免未夹紧就抬
      gripper_close_min_dwell_ms: 2500
      # 打开后最小停留 (ms)，再允许转 PREGRASP，避免臂动时夹爪仍在张开
      gripper_open_min_dwell_ms: 1500
      # 机械臂每步完成后按关节角度+速度稳定再进入下一步（超时=失败，不继续）
      # 放宽阈值以适配 descend 后收敛抖动/速度噪声，避免 10s 判不稳→ABORT_SAFE
      arm_stable_timeout_ms: 15000   # 最大等待 (ms)，超时则 ABORT_SAFE
      arm_stable_threshold_rad: 0.004  # 关节角度变化阈值 (rad)，约 0.23°（原 0.002 过紧）
      arm_stable_window: 8           # 连续满足 pos+vel 的采样次数（8~10 更易达稳）
      arm_stable_velocity_eps_rad_s: 0.012  # 速度判稳 (rad/s)，max(|vel|) 小于此值（原 0.005 过敏感）
      arm_stable_min_dwell_ms: 800   # 稳定后最小停留 (ms)，再允许进入下一步
      # 关节（臂）执行超时：在 task_runner 中 MIN_TIMEOUT=35s（≥ Joint1 全行程 30s），
      # 执行超时 = max(MIN_TIMEOUT, 轨迹估算时间*1.5)，无需在此单独配置
      # 启动前 joint_states 就绪门槛（避免 current_state 全0/旧值导致先跑再回）
      joint_states_ready_enabled: true   # 是否在启动抓取前等待 /joint_states 稳定
      joint_states_ready_min_count: 10   # 至少收到的 joint_states 次数
      joint_states_ready_max_age_s: 0.3  # 最后一帧不得超过此时间(s)，否则认为断流
      joint_states_ready_nonzero_eps: 0.01  # 关节不全零：sum(|position|) 需大于此值

    trajectory:
      # =========================================
      # 范围执行时间（全行程时间，用于超时/速度估算）
      # =========================================
      range_execution_time:
        joint1: 30.0   # s  Joint1 全行程
        joint2: 13.0   # s  Joint2 全行程
        joint3: 13.0   # s  Joint3 全行程
        joint4: 21.0   # s  Joint4 全行程
        gripper: 7.5   # s  夹爪全行程（JointGL/JointGR）

      # 执行超时与轨迹时间修复（改此处即可生效，无需改代码）
      execution_timeout_margin_s: 5.0    # s  最小超时 = range_execution_time.joint1 + 此值
      min_execution_timeout_s: 35.0      # s  执行超时下限
      max_execution_timeout_s: 300.0     # s  执行超时上限
      execution_timeout_safety_factor: 1.5  # 估算时间 × 此系数 作为超时
      min_segment_time_s: 0.05           # s  轨迹段最小时长（时间修复用）
      min_arm_trajectory_time_s: 1.0     # s  机械臂轨迹最小总时长（时间修复用）

      # =========================================
      # 轨迹规划配置（优先稳定性和平滑度）
      # =========================================
      
      # 笛卡尔空间直线插补配置
      use_linear_interpolation: true  # 是否使用精确直线插补（使用TrajectoryPlanner）
      linear_velocity: 0.05           # m/s  直线插补的默认速度（降到5cm/s，更平滑）
      linear_min_duration: 2.0        # s  线性插补最小持续时间（增加到2秒）
      linear_step_scale: 0.3          # 线性插补时步长缩放因子（更小步长=更多点）
      
      # 笛卡尔路径规划参数
      cartesian_timeout: 10.0         # s  笛卡尔路径计算默认超时时间（增加到10秒）
      cartesian_timeout_descend: 15.0 # s  下压专用超时时间（增加到15秒）
      cartesian_timeout_lift: 10.0    # s  抬起专用超时时间（增加到10秒）
      cartesian_descend_threshold: 0.95  # descend（下压）路径成功率阈值
      cartesian_lift_threshold: 0.90     # lift（抬起）路径成功率阈值
      cartesian_retry_on_timeout: true  # 超时后是否重试（减少waypoints后重试）
      
      # 自适应分段参数（增加分段数=更多waypoints=更平滑）
      adaptive_segments: true         # 是否启用自适应分段（根据距离动态调整）
      min_segments: 5                 # 最小分段数（增加到5，生成6个waypoints）
      max_segments: 10                # 最大分段数（增加到10，生成11个waypoints）
      
      # 关节空间多项式插值配置
      use_polynomial_interpolation: true  # 是否启用多项式插值轨迹规划
      polynomial_type: "quintic"          # "cubic" 或 "quintic"（quintic更平滑，保证加速度连续）
      polynomial_duration: 5.0            # s  多项式轨迹持续时间（增加到5秒，非常平滑）
      polynomial_dt: 0.05                 # s  多项式轨迹时间步长（20Hz，匹配机械臂控制频率）
      
      # B样条曲线轨迹规划配置
      use_bspline: true        # 是否启用B样条曲线轨迹规划
      bspline_degree: 3         # B样条阶数（3或4）
      bspline_duration: 6.0     # s  B样条轨迹持续时间（增加到6秒，非常平滑）
      bspline_dt: 0.05         # s  B样条轨迹时间步长（20Hz，匹配机械臂控制频率）
      
      # 时间参数化配置（MoveIt Time Parameterization）
      # 对轨迹进行时间最优重参数化，考虑关节速度/加速度限制
      use_time_parameterization: true       # 是否启用时间参数化
      time_param_algorithm: "iterative_spline"  # 算法类型：totg/iterative_spline/iterative_parabolic
                                            # - totg: 时间最优，速度快但可能轻微偏离路径
                                            # - iterative_spline: 迭代样条，更平滑（推荐，减少抖动）
                                            # - iterative_parabolic: 迭代抛物线，梯形速度曲线
      time_param_velocity_scaling: 0.3      # 速度缩放因子（降到30%，优先平滑）
      time_param_acceleration_scaling: 0.2  # 加速度缩放因子（降到20%，优先平滑）
      
      # 轨迹重采样与步长（厂家建议：机械臂+夹爪所有关节轨迹步长不要太短如1度，约10度发一点，点要散一点减少抖动）
      use_trajectory_resampling: true       # 是否启用轨迹重采样
      control_frequency: 10.0               # Hz  降低密度，点更散（原20Hz过密易抖）
      min_joint_step_deg: 5.0               # 度  相邻点最小步长（3~5° 更平滑，减少末端冲量/判稳过早）

    gripper:
      # 夹爪控制：开/关。实机 axis5 范围 -1100～0（闭合=0，张开=-1100）；JointGL/JointGR 弧度 [-1.01, 1.01] 与 axis5 线性对应
      open_width: 0.030        # m  张开宽度（用于 widthToJointAngle）
      close_width: 0.0         # m  闭合时宽度=0 → angle_min
      close_extra: 0.0         # m  闭合不需额外压紧
      angle_min: 1.01          # rad  闭合（axis5=0）
      angle_max: -1.01         # rad  张开（axis5=-1100）
      width_min: 0.0           # m   最小宽度
      stable_samples: 10        # 打开/闭合验证：连续采样次数（提高以减少未到位就判稳）
      stable_threshold_rad: 0.008 # 相邻采样变化小于此(rad)视为不变，约 0.46°
      stable_velocity_eps_rad_s: 0.01  # 速度判稳 (rad/s)，max(|vel|) 小于此值并持续 N 次才判“到位”
      stable_interval_ms: 80     # 采样间隔 ms
      post_execute_wait_ms: 2000 # 写目标后等待 ms，再判“运动开始/数值不变”
      # 两阶段判稳：先等“数值在变化”（运动开始），再等“数值不变”=到位/夹到（0=闭合 -1100=全开）
      motion_start_threshold_rad: 0.008  # 判定“开始运动”的最小变化 (rad)，约 0.46°
      motion_start_timeout_ms: 3000      # 等待运动开始最大 ms，超时仍进入判稳（如已在目标）
      stable_timeout_ms: 8000            # 等待数值不变最大 ms，闭合超时=未夹到/失败，打开超时仍成功

    scene:
      add_collision_object: true
      allow_touch_links: ["LinkGG", "LinkGL", "LinkGR"]
